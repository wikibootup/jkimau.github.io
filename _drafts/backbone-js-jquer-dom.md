---
layout: post
title: Backbone.js와 jQuery 그리고 DOM 접근에 관한 개인적 잡견
category: backbone.js
---

Backbone.js는 Angular.js, React.js에 이어 프론트 엔드 개발에 가장 많이 사용되는 MVC패턴 (이라고 일단 하자. 정확히 말하자면 MVP도 아니고 MVVM도 아니고 그냥 MVW(Whatever)패턴 이다. 여튼, 이번 글 주제와 크게 연관 없으므로 이 부분은 패스) 개발을 가능하게 해주는 라이브러리다.

MVC패턴이 무조건 만능은 아니겠지만, 거의 대부분의 경우 모델, 뷰, 컨트롤러를 분리 시킴으로써 전체적으로 웹 앱의 유지 보수를 확실히 더 편하게 해준다. 특히 앱의 규모가 커질수록 MVC패턴의 역할은 더욱 중요해 진다.

이 글을 통해 Backbone이 가지고 있는 문제점과 나름의 극복 방안을 얘기하고자 한다.

## DOM 접근의 필요성
DOM(Document Object Model), 아주 쉽게 말하자면 HTML 등의 마크업 노드들을 트리 형태의 오브젝트로 만들어 접근, 수정 등을 용이하게 만들어 주는 것이다. MVC패턴 중 View에 해당 한다고 보면 된다. 그리고 모든 프론트엔드 개발의 근본적 목적은 원하는 데이터를(모델) 원하는 형태로 변형 또는 조합시켜서(컨트롤러) 화면에 보여지게(뷰) 하는 것이다. 따라서 이런 의미에서 DOM 접근은 어떤 프론트앤드 개발 또는 프론트앤드 프레임웍을 막론하고 필수적으로 필요 하다고 말 할 수 있다.
다만, 어떻게 접근하느냐의 문제일 뿐이다.

## jQuery or NOT?
jQuery는 이런 DOM 접근 및 수정에 있어 가장 많이 사용되는 라이브러리다. 그만큼 강력하고 사용하기 쉽다는 의미이기도 하다. Backbone의 경우 Angular와 달리 자체적으로 컨트롤러와 뷰가 바인드 되어 있지 않으므로 대부분의 경우 jQuery 또는 이에 해당하는 다른 라이브러리를 이용해 DOM에 접근 한다.

문제는 여기서 시작된다.

애초에 MVC패턴의 탄생 목적이 모델, 뷰, 컨트롤러를 완전히 분리 시키기 위해 나온 것인데 Backbone의 경우 컨트롤러에 해당하는 자바스크립트 파일에서 jQuery를 이용해 뷰에 직접 접근하게 된다. 이 점이 바로 Backbone.js를 정확히 MVC패턴이라 부르기 어렵게 하는 대목이다.

간단한 뷰인 경우에는 짧게 끝나겠지만 많은 로직이 들어가고 복잡한 뷰 구조를 가지고 있으면 말이 달라진다. 더구나 시간이 지나면서 뷰의 업데이트가 추가 될수록 컨트롤러에 해당하는 자바스크립트 파일은 순식간에 jQuery로 인해 뷰와 바인드가 된 듯 안 된 듯한 어지러운 구조가 되어 버린다. 그렇게 강력하고 사용하기 편한 jQuery가 MVC패턴 관점에서 봤을 때 아주 성가신 골칫거리가 되는 순간이다.

이러한 이유로 특히 Angular.js 진영에서는 jQuery 사용 자체를 아주 꺼려하는 분위기가 조금씩 확산되고 있다. Angular.js 사용자 입장에서는 그럴만도 한 것이 컨트롤러와 뷰가 제대로 바인딩 되어 있어서 DOM 접근을 위한 라이브러리를 따로 사용하지 않아도 되는 경우가 많다. 다만, 특히 dropdown 메뉴등의 간단한 애니메이션은 jQuery를 사용하는것이 훨씬 쉽게 끝날 일인데도 굳이 힘들게 외부 모듈까지 동원해가며 jQuery를 배척하는 모습이 조금은 안쓰러워 보이기도 하지만 어쨌든 MVC 패턴의 장점과 취지만을 놓고 보자면 충분히 이해가는 부분이기도 하다.

## Backbone without jQuery?
그렇다면 Backbone.js에서도 jQuery를 사용하지 않고 개발하는 방법이 있을까? 결론부터 말하자면 '그럴 수 없다' 이다. 좀 더 정확히 말하자면 jQuery이외의 다른 라이브러리를 사용할 수는 있지만 앞에서 잠시 설명했듯 DOM 접근 및 수정을 하지않고 프론트앤드 개발을 하는 경우는 없다. 넓게 보자면 프론트앤드 개발의 주 목적이 바로 DOM 접근 및 수정이기 때문이다.

그렇다면 전혀 방법이 없는가? 라는 질문에서 이 글이 시작되었고 jQuery를 컨트롤러의 로직 부분에서 최대한 떨어뜨리는 방법이 그나마 최선이었고 몇 가지 방법을 공유 하고자 한다. 모든 상황에 맞는 만능 해결책도 아닐 뿐더러 어떻게 보면 불필요한 과정에 지나지 않을 수도 있다. 내가 개인적으로 사용하는 방법이니 그냥 이런 방법도 있구나하고 가볍게 흘리면 되겠다.

핵심은,
    1. DOM접근 관련 함수는 따로 모아서 유틸리티처럼 사용
    2. `$el`을 파라미터로 넘겨서 성능 저하를 피함
이다.


* 모듈 디자인 패턴이 아닐 때는 namespace를 이용
```
App = App || {};

var App.DOMUtil = {

}

var App.view = Backbone.view.extend({
    template: '/index.html',
    events: {
        'click button': '_toggleColor'
    },
    render: function() {
        // do render
    },
    _toggleColor: function() {
        // toggle color
    }
});

return App.view;
```

* 모듈 디자인 패턴일 때는 디펜던시 인젝션을 이용
